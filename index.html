<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPS æµ‹è¯„æ•°æ®å±•ç¤º</title>
    <style>
        /* ========== è®¿é—®éªŒè¯æ ·å¼ ========== */
        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        #auth-overlay.hidden { display: none; }
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        .auth-box h2 {
            margin-bottom: 10px;
            color: #333;
        }
        .auth-box p {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .auth-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        .auth-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        .auth-box button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .auth-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .auth-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        #main-content { display: none; }
        #main-content.visible { display: block; }
        /* ========== è®¿é—®éªŒè¯æ ·å¼ç»“æŸ ========== */

        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #e1e8ed;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .filters {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 500;
            color: #666;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            border-color: var(--primary-color);
        }

        .vendor-section {
            margin-bottom: 40px;
        }

        .vendor-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 20px;
            z-index: 100;
            border-left: 5px solid var(--primary-color);
        }

        .vendor-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .vendor-badge {
            background: var(--secondary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .product-header {
            background: #f8f9fa;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .product-title-group h3 {
            font-size: 1.2rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .product-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .product-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .plan-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s ease;
            background: #fff;
            display: flex;
            flex-direction: column;
        }

        .plan-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-color: var(--primary-color);
        }

        .plan-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.05rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .plan-specs {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .spec-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #555;
        }

        .spec-row strong {
            color: var(--text-color);
        }

        .plan-prices {
            background: #f8f9fa;
            margin: 0 -15px -15px -15px;
            padding: 10px 15px;
            border-top: 1px solid #eee;
            border-radius: 0 0 8px 8px;
        }

        .price-tag {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .price-tag:last-child {
            margin-bottom: 0;
        }

        .price-val {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .loading, .no-data, .error {
            text-align: center;
            padding: 60px;
            color: #888;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: #fff5f5;
            color: #c0392b;
            border: 1px solid #ffcccc;
            border-radius: 8px;
        }

        .toggle-btn {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .action-link {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .link-review {
            background: #eef2f7;
            color: var(--text-color);
        }
        .link-review:hover { background: #e1e8ed; }

        .link-buy {
            background: var(--secondary-color);
            color: white;
        }
        .link-buy:hover { background: #27ae60; }

        .collapsed .plans-grid, 
        .collapsed .product-actions {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ========== è®¿é—®éªŒè¯å±‚ ========== -->
    <div id="auth-overlay">
        <div class="auth-box">
            <h2>ğŸ” è®¿é—®éªŒè¯</h2>
            <p>è¯·è¾“å…¥è®¿é—®å¯†é’¥ä»¥æŸ¥çœ‹å†…å®¹</p>
            <input type="password" id="auth-token" placeholder="è¯·è¾“å…¥å¯†é’¥" onkeypress="if(event.key==='Enter')verifyToken()">
            <button onclick="verifyToken()">éªŒè¯</button>
            <div class="auth-error" id="auth-error">å¯†é’¥é”™è¯¯ï¼Œè¯·é‡è¯•</div>
        </div>
    </div>
    <!-- ========== è®¿é—®éªŒè¯å±‚ç»“æŸ ========== -->

    <div id="main-content" class="container">
        <header>
            <h1>ğŸ–¥ï¸ VPS æµ‹è¯„æ•°æ®å±•ç¤º</h1>
            <p>æ•°æ®æ¥æº: ç‹—æ±ªVPSæµ‹è¯„ç½‘</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="vendorCount">-</div>
                    <div class="stat-label">æœåŠ¡å•†</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="productCount">-</div>
                    <div class="stat-label">äº§å“ç³»åˆ—</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="planCount">-</div>
                    <div class="stat-label">åœ¨å”®å¥—é¤</div>
                </div>
            </div>
        </header>

        <!-- å…è´£å£°æ˜ -->
        <div class="disclaimer" style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px 20px; margin-bottom: 20px; font-size: 0.9rem; color: #856404;">
            <strong>âš ï¸ å…è´£å£°æ˜ï¼š</strong>
            æœ¬é¡µé¢æ•°æ®ç”± AI è‡ªåŠ¨ä»<a href="https://www.gwvpsceping.com/" target="_blank" rel="noopener" style="color: #0056b3;">ç‹—æ±ª VPS æµ‹è¯„ç½‘</a>æŠ“å–å¹¶è§£æï¼Œä»…ä¾›å­¦ä¹ å’Œå‚è€ƒä½¿ç”¨ã€‚
            æ•°æ®å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–è¿‡æ—¶ï¼Œè¯·ä»¥å„æœåŠ¡å•†å®˜ç½‘ä¸ºå‡†ã€‚æœ¬é¡¹ç›®ä¸å¯¹æ•°æ®å‡†ç¡®æ€§è´Ÿè´£ï¼Œä¸æ„æˆä»»ä½•è´­ä¹°å»ºè®®ã€‚
            å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ã€‚
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>æœåŠ¡å•†:</label>
                <select id="vendorFilter"><option value="">å…¨éƒ¨</option></select>
            </div>
            <div class="filter-group">
                <label>åœ°åŒº:</label>
                <select id="locationFilter"><option value="">å…¨éƒ¨</option></select>
            </div>
            <div class="filter-group">
                <label>æœ€é«˜é¢„ç®—(å…ƒ/å¹´):</label>
                <input type="number" id="maxPriceFilter" placeholder="ä¸é™" style="width: 100px;">
            </div>
            <div class="filter-group">
                <label>å†…å­˜ >=</label>
                <select id="minMemoryFilter">
                    <option value="">ä¸é™</option>
                    <option value="0.5">512 MB</option>
                    <option value="1">1 GB</option>
                    <option value="2">2 GB</option>
                    <option value="4">4 GB</option>
                    <option value="8">8 GB</option>
                </select>
            </div>
            <button class="toggle-btn" style="background:var(--text-color);color:white;border:none" onclick="resetFilters()">é‡ç½®</button>
        </div>

        <div id="content">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨è¯»å–æµ‹è¯„æ•°æ®...</p>
            </div>
        </div>
    </div>

    <script>
        // ========== è®¿é—®éªŒè¯é€»è¾‘ ==========
        // ä¿®æ”¹æ­¤å¯†é’¥æ¥è®¾ç½®è®¿é—®å¯†ç ï¼ˆå»ºè®®ä½¿ç”¨å¤æ‚å­—ç¬¦ä¸²ï¼‰
        const ACCESS_TOKEN = 'vps2026';
        const TOKEN_STORAGE_KEY = 'vps_access_token';

        function verifyToken() {
            const input = document.getElementById('auth-token').value;
            const errorEl = document.getElementById('auth-error');
            
            if (input === ACCESS_TOKEN) {
                // éªŒè¯æˆåŠŸï¼Œä¿å­˜åˆ° sessionStorageï¼ˆå…³é—­æµè§ˆå™¨åå¤±æ•ˆï¼‰
                sessionStorage.setItem(TOKEN_STORAGE_KEY, input);
                unlockContent();
            } else {
                errorEl.style.display = 'block';
                document.getElementById('auth-token').value = '';
            }
        }

        function checkAuth() {
            // æ”¯æŒ URL å‚æ•°éªŒè¯ï¼š?token=xxx
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get('token');
            const storedToken = sessionStorage.getItem(TOKEN_STORAGE_KEY);
            
            if (urlToken === ACCESS_TOKEN || storedToken === ACCESS_TOKEN) {
                if (urlToken === ACCESS_TOKEN) {
                    sessionStorage.setItem(TOKEN_STORAGE_KEY, urlToken);
                }
                unlockContent();
                return true;
            }
            return false;
        }

        function unlockContent() {
            document.getElementById('auth-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.add('visible');
        }
        // ========== è®¿é—®éªŒè¯é€»è¾‘ç»“æŸ ==========

        // æ›´æ–°åçš„æ–‡ä»¶åˆ—è¡¨
        const jsonFiles = [
            'data/raw/8748.json', 'data/raw/8750.json', 'data/raw/8752.json',
            'data/raw/8754.json', 'data/raw/8756.json', 'data/raw/8758.json',
            'data/raw/8760.json', 'data/raw/8765.json', 'data/raw/8767.json',
            'data/raw/8770.json', 'data/raw/8772.json', 'data/raw/8774.json',
            'data/raw/8777.json', 'data/raw/8781.json', 'data/raw/8785.json'
        ];

        let globalData = []; // æ‰å¹³åŒ–çš„äº§å“åˆ—è¡¨
        let vendorsMap = new Map(); // Vendor Name -> [Products]
        
        async function init() {
            const contentDiv = document.getElementById('content');
            try {
                // 1. å¹¶å‘åŠ è½½æ‰€æœ‰JSON
                const responses = await Promise.all(jsonFiles.map(url => fetch(url).then(r => r.ok ? r.json() : null).catch(e => null)));
                const validData = responses.filter(d => d);

                if (validData.length === 0) {
                    throw new Error("æ²¡æœ‰è¯»å–åˆ°ä»»ä½•æœ‰æ•ˆæ•°æ®");
                }

                // 2. æ•°æ®å¤„ç†ä¸åˆå¹¶
                processData(validData);

                // 3. æ¸²æŸ“
                render();
                populateFilters();

            } catch (e) {
                contentDiv.innerHTML = `<div class="error"><h3>åŠ è½½å¤±è´¥</h3><p>${e.message}</p></div>`;
                console.error(e);
            }
        }

        function processData(rawDataList) {
            globalData = [];
            vendorsMap.clear();

            rawDataList.forEach(fileData => {
                if (!fileData.products || !Array.isArray(fileData.products)) return;

                fileData.products.forEach(prod => {
                    // æ³¨å…¥æ¥æºä¿¡æ¯ï¼Œæ–¹ä¾¿è·³è½¬
                    prod._meta = {
                        article_title: fileData.article_title,
                        source_url: fileData.source_url,
                        publish_date: fileData.publish_date
                    };

                    globalData.push(prod);

                    // å½’ä¸€åŒ–æœåŠ¡å•†åç§° (å»é™¤é¦–å°¾ç©ºæ ¼ï¼Œä½œä¸ºKey)
                    let vName = (prod.vendor || 'æœªçŸ¥æœåŠ¡å•†').trim();
                    if (!vendorsMap.has(vName)) {
                        vendorsMap.set(vName, []);
                    }
                    vendorsMap.get(vName).push(prod);
                });
            });

            updateStats();
        }

        function updateStats() {
            document.getElementById('vendorCount').textContent = vendorsMap.size;
            document.getElementById('productCount').textContent = globalData.length;
            const totalPlans = globalData.reduce((acc, p) => acc + (p.plans ? p.plans.length : 0), 0);
            document.getElementById('planCount').textContent = totalPlans;
        }

        function populateFilters() {
            const vSelect = document.getElementById('vendorFilter');
            const lSelect = document.getElementById('locationFilter');
            const locations = new Set();

            // å¡«å……æœåŠ¡å•†
            Array.from(vendorsMap.keys()).sort().forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                vSelect.appendChild(opt);
            });

            // æå–åœ°åŒº (ç®€å•å»é‡)
            globalData.forEach(p => {
                if(p.location) locations.add(p.location.trim());
            });
            Array.from(locations).sort().forEach(l => {
                const opt = document.createElement('option');
                opt.value = l;
                opt.textContent = l;
                lSelect.appendChild(opt);
            });

            // ç»‘å®šäº‹ä»¶
            ['vendorFilter', 'locationFilter', 'minMemoryFilter'].forEach(id => {
                document.getElementById(id).addEventListener('change', render);
            });
            document.getElementById('maxPriceFilter').addEventListener('input', render);
        }

        function resetFilters() {
            document.getElementById('vendorFilter').value = "";
            document.getElementById('locationFilter').value = "";
            document.getElementById('maxPriceFilter').value = "";
            document.getElementById('minMemoryFilter').value = "";
            render();
        }

        // æ ¸å¿ƒæ¸²æŸ“é€»è¾‘
        function render() {
            const content = document.getElementById('content');
            const filters = {
                vendor: document.getElementById('vendorFilter').value,
                location: document.getElementById('locationFilter').value,
                maxPrice: parseFloat(document.getElementById('maxPriceFilter').value) || Infinity,
                minMem: parseFloat(document.getElementById('minMemoryFilter').value) || 0
            };

            // é‡æ–°æŒ‰ç­›é€‰æ¡ä»¶æ„å»ºåˆ†ç»„
            // é€»è¾‘ï¼šéå†æ‰€æœ‰Vendorï¼Œç­›é€‰å…¶ä¸‹çš„Productï¼Œå†ç­›é€‰Productä¸‹çš„Plan
            // å¦‚æœä¸€ä¸ªProductä¸‹æ²¡æœ‰ç¬¦åˆçš„Planï¼Œåˆ™ä¸æ˜¾ç¤ºè¯¥Product
            // å¦‚æœä¸€ä¸ªVendorä¸‹æ²¡æœ‰ç¬¦åˆçš„Productï¼Œåˆ™ä¸æ˜¾ç¤ºè¯¥Vendor

            let html = '';
            let hasData = false;

            // æŒ‰Vendoråç§°æ’åºæ¸²æŸ“
            const sortedVendors = Array.from(vendorsMap.keys()).sort();

            for (const vendorName of sortedVendors) {
                // 1. Vendor çº§ç­›é€‰
                if (filters.vendor && vendorName !== filters.vendor) continue;

                const vendorProducts = vendorsMap.get(vendorName);
                let visibleProductsHtml = '';

                vendorProducts.forEach((product, idx) => {
                    // 2. Product çº§ç­›é€‰ (Location)
                    // æ¨¡ç³ŠåŒ¹é…ï¼šå¦‚æœç­›é€‰äº†åœ°åŒºï¼Œè¦æ±‚ product.location åŒ…å«è¯¥è¯ï¼Œæˆ–è€… product_name åŒ…å«
                    if (filters.location && !((product.location || '').includes(filters.location))) {
                        return; 
                    }

                    // 3. Plan çº§ç­›é€‰
                    // åªè¦æœ‰ä¸€ä¸ªPlanç¬¦åˆè¦æ±‚ï¼Œå°±æ˜¾ç¤ºè¯¥Product
                    const validPlans = (product.plans || []).filter(plan => {
                        // å†…å­˜æ£€æŸ¥
                        const memVal = plan.memory ? parseFloat(plan.memory.value) : 0;
                        const memUnit = plan.memory ? plan.memory.unit.toUpperCase() : '';
                        let memGB = memVal;
                        if (memUnit === 'MB') memGB = memVal / 1024;
                        if (memGB < filters.minMem) return false;

                        // ä»·æ ¼æ£€æŸ¥ (æ£€æŸ¥æ‰€æœ‰ä»·æ ¼é€‰é¡¹ï¼Œåªè¦æœ‰ä¸€ä¸ªä½äº maxPrice å³å¯)
                        const prices = Array.isArray(plan.price) ? plan.price : (plan.price ? [plan.price] : []);
                        if (prices.length === 0) return true; // æ²¡å†™ä»·æ ¼é»˜è®¤æ˜¾ç¤º? æˆ–è€…ä¸æ˜¾ç¤º
                        
                        // å¯»æ‰¾æœ€ä½å¹´ä»˜æŠ˜ç®—ä»·æ ¼ï¼Œè¿™é‡Œç®€åŒ–ä¸ºï¼šåªè¦æœ‰ä¸€ä¸ªä»·æ ¼é¡¹çš„å€¼ <= maxPrice (å‡è®¾ç”¨æˆ·è¾“å…¥çš„æ˜¯å¹´ä»˜é¢„ç®—)
                        // é€šå¸¸ç”¨æˆ·è¾“å…¥çš„æ˜¯"é¢„ç®—"ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¥—é¤åªè¦ 48å…ƒ(æœˆä»˜)ï¼Œç”¨æˆ·é¢„ç®—100ï¼Œåº”è¯¥æ˜¾ç¤ºå—ï¼Ÿ
                        // ç®€å•çš„é€»è¾‘ï¼šå¦‚æœæ˜¯æœˆä»˜ï¼Œx12 ä¼°ç®—ï¼Ÿæˆ–è€…ç›´æ¥æ¯”å¯¹æ•°å€¼ï¼Ÿ
                        // æ—¢ç„¶ Filter æ ‡ç­¾å†™çš„æ˜¯ "æœ€é«˜é¢„ç®—(å…ƒ/å¹´)"ï¼Œé‚£æˆ‘ä»¬åº”è¯¥æŠŠæ‰€æœ‰ä»·æ ¼å½’ä¸€åŒ–ä¸ºå¹´ä»˜æ¯”è¾ƒ
                        // æˆ–è€…ç®€å•ç‚¹ï¼šåªè¦æœ‰ä¸€ä¸ªä»·æ ¼é¡¹ <= filters.maxPrice (å¦‚æœå®ƒæ˜¯å¹´ä»˜)
                        // ä¸ºé¿å…å¤æ‚ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥äº†ä»·æ ¼ç­›é€‰ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä¸€ä»·æ ¼æ¡ç›® <= filters.maxPrice
                        // å¹¶ä¸”å•ä½åŒ¹é…? æš‚æ—¶åªæ¯”å¯¹æ•°å€¼ã€‚
                        
                        const hasAffordableOption = prices.some(p => {
                            // ç®€å•æ•°å€¼æ¯”å¯¹
                            return parseFloat(p.value) <= filters.maxPrice;
                        });
                        return hasAffordableOption;
                    });

                    if (validPlans.length === 0) return;

                    // æ¸²æŸ“ Product
                    const pid = `prod-${Math.random().toString(36).substr(2,9)}`;
                    visibleProductsHtml += `
                        <div class="product-card" id="${pid}">
                            <div class="product-header">
                                <div class="product-title-group">
                                    <h3>${escapeHtml(product.product_name)}</h3>
                                    <div class="product-meta">
                                        <span>ğŸ“ ${escapeHtml(product.location || 'æœªçŸ¥')}</span>
                                        ${product.purchase_url ? '<span>ğŸ›’ å¯è´­ä¹°</span>' : ''}
                                    </div>
                                </div>
                                <button class="toggle-btn" onclick="document.getElementById('${pid}').classList.toggle('collapsed')">
                                    æŠ˜å /å±•å¼€
                                </button>
                            </div>
                            
                            <div class="plans-grid">
                                ${validPlans.map(plan => renderPlan(plan)).join('')}
                            </div>

                            <div class="product-actions">
                                ${product._meta.source_url ? 
                                    `<a href="${product._meta.source_url}" target="_blank" class="action-link link-review">ğŸ“„ æŸ¥çœ‹æµ‹è¯„åŸæ–‡</a>` : ''}
                                ${product.purchase_url ? 
                                    `<a href="${product.purchase_url}" target="_blank" class="action-link link-buy">âš¡ ç›´è¾¾è´­ä¹°</a>` : ''}
                            </div>
                        </div>
                    `;
                });

                if (visibleProductsHtml) {
                    hasData = true;
                    html += `
                        <div class="vendor-section">
                            <div class="vendor-header">
                                <span class="vendor-name">${escapeHtml(vendorName)}</span>
                                <span class="vendor-badge" style="margin-left:10px">${vendorProducts.length} ç³»åˆ—</span>
                            </div>
                            <div class="vendor-products">
                                ${visibleProductsHtml}
                            </div>
                        </div>
                    `;
                }
            }

            if (!hasData) {
                content.innerHTML = '<div class="no-data">ğŸ˜• æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ VPS</div>';
            } else {
                content.innerHTML = html;
            }
        }

        function renderPlan(plan) {
            const cpu = plan.cpu ? `${plan.cpu.cores}æ ¸ ${plan.cpu.model || ''}` : '-';
            const mem = plan.memory ? `${plan.memory.value}${plan.memory.unit}` : '-';
            const disk = plan.storage ? `${plan.storage.value}${plan.storage.unit} ${plan.storage.type||''}` : '-';
            const traffic = plan.traffic ? (plan.traffic.value === -1 || plan.traffic.value === "-1" ? 'æ— é™æµé‡' : `${plan.traffic.value}${plan.traffic.unit}`) : '-';
            const speed = plan.bandwidth ? `${plan.bandwidth.value}${plan.bandwidth.unit}` : '-';
            
            // ä»·æ ¼æ¸²æŸ“ï¼šå…¼å®¹æ•°ç»„(å®é™…äº§å‡º)å’Œå•å¯¹è±¡(Schemaå®šä¹‰)
            let priceHtml = '';
            const prices = Array.isArray(plan.price) ? plan.price : (plan.price ? [plan.price] : []);
            
            if (prices.length > 0) {
                priceHtml = prices.map(p => `
                    <div class="price-tag">
                        <span>${p.period || 'ä»·æ ¼'}</span>
                        <span class="price-val">${p.currency === 'CNY'?'Â¥':(p.currency === 'USD'?'$':(p.currency || ''))}${p.value}</span>
                    </div>
                `).join('');
            } else {
                priceHtml = '<div class="price-tag">æš‚æ— ä»·æ ¼</div>';
            }

            return `
                <div class="plan-card">
                    <div class="plan-name">${escapeHtml(plan.name || 'é»˜è®¤å¥—é¤')}</div>
                    <div class="plan-specs">
                        <div class="spec-row"><strong>CPU</strong> <span>${cpu}</span></div>
                        <div class="spec-row"><strong>å†…å­˜</strong> <span>${mem}</span></div>
                        <div class="spec-row"><strong>ç¡¬ç›˜</strong> <span>${disk}</span></div>
                        <div class="spec-row"><strong>å¸¦å®½</strong> <span>${speed}</span></div>
                        <div class="spec-row"><strong>æµé‡</strong> <span>${traffic}</span></div>
                    </div>
                    <div class="plan-prices">
                        ${priceHtml}
                    </div>
                </div>
            `;
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;")
                       .replace(/</g, "&lt;")
                       .replace(/>/g, "&gt;")
                       .replace(/"/g, "&quot;")
                       .replace(/'/g, "&#039;");
        }

        // Start - å…ˆéªŒè¯è®¿é—®æƒé™
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                init();
            }
            // æœªéªŒè¯æ—¶æ˜¾ç¤ºç™»å½•æ¡†ï¼Œç”¨æˆ·è¾“å…¥åæ‰‹åŠ¨è§¦å‘ init
            document.getElementById('auth-token').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') verifyToken();
            });
        });

        // éªŒè¯æˆåŠŸåçš„å›è°ƒ
        const originalUnlock = unlockContent;
        unlockContent = function() {
            originalUnlock();
            init();
        };
    </script>
</body>
</html>